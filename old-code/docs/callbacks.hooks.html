---

title: callbacks.hooks
keywords: fastai
sidebar: home_sidebar

summary: "Implement callbacks using hooks"
---
<!--


#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: docs_src/callbacks.hooks.ipynb
# instructions: https://docs.fast.ai/gen_doc_main.html

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Hook-callbacks">Hook callbacks<a class="anchor-link" href="#Hook-callbacks">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This provides both a standalone class and a callback for registering and automatically deregistering <a href="https://pytorch.org/tutorials/beginner/former_torchies/nn_tutorial.html#forward-and-backward-function-hooks">PyTorch hooks</a>, along with some pre-defined hooks. Hooks can be attached to any <a href="https://pytorch.org/docs/stable/nn.html#torch.nn.Module"><code>nn.Module</code></a>, for either the forward or the backward pass.</p>
<p>We'll start by looking at the pre-defined hook <a href="/callbacks.hooks.html#ActivationStats"><code>ActivationStats</code></a>, then we'll see how to create our own.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ActivationStats" class="doc_header"><code>class</code> <code>ActivationStats</code><a href="https://github.com/fastai/fastai1/blob/master/fastai/callbacks/hooks.py#L82" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#ActivationStats-pytest" style="float:right; padding-right:10px">[test]</a></h2><blockquote><p><code>ActivationStats</code>(<strong><code>learn</code></strong>:<a href="/basic_train.html#Learner"><code>Learner</code></a>, <strong><code>modules</code></strong>:<code>Sequence</code>[<a href="https://pytorch.org/docs/stable/nn.html#torch.nn.Module"><code>Module</code></a>]=<strong><em><code>None</code></em></strong>, <strong><code>do_remove</code></strong>:<code>bool</code>=<strong><em><code>True</code></em></strong>) :: <a href="/callbacks.hooks.html#HookCallback"><code>HookCallback</code></a></p>
</blockquote>
<div class="collapse" id="ActivationStats-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#ActivationStats-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>ActivationStats</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Callback that record the mean and std of activations.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/callbacks.hooks.html#ActivationStats"><code>ActivationStats</code></a> saves the layer activations in <code>self.stats</code> for all <code>modules</code> passed to it. By default it will save activations for <em>all</em> modules. For instance:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">MNIST_SAMPLE</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ImageDataBunch</span><span class="o">.</span><span class="n">from_folder</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="c1">#learn = cnn_learner(data, models.resnet18, callback_fns=ActivationStats)</span>
<span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">simple_cnn</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">callback_fns</span><span class="o">=</span><span class="n">ActivationStats</span><span class="p">)</span>
<span class="n">learn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.142666</td>
      <td>0.101166</td>
      <td>00:03</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The saved <code>stats</code> is a <code>FloatTensor</code> of shape <code>(2,num_modules,num_batches)</code>. The first axis is <code>(mean,stdev)</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">learn</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">train_dl</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">learn</span><span class="o">.</span><span class="n">activation_stats</span><span class="o">.</span><span class="n">modules</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(193, 3)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">activation_stats</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([2, 3, 193])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So this shows the standard deviation (<code>axis0==1</code>) of 2th last layer (<code>axis1==-2</code>) for each batch (<code>axis2</code>):</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">learn</span><span class="o">.</span><span class="n">activation_stats</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">());</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Internal-implementation">Internal implementation<a class="anchor-link" href="#Internal-implementation">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ActivationStats.hook" class="doc_header"><code>hook</code><a href="https://github.com/fastai/fastai1/blob/master/fastai/callbacks/hooks.py#L90" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#ActivationStats-hook-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>hook</code>(<strong><code>m</code></strong>:<a href="https://pytorch.org/docs/stable/nn.html#torch.nn.Module"><code>Module</code></a>, <strong><code>i</code></strong>:<code>Tensors</code>, <strong><code>o</code></strong>:<code>Tensors</code>) → <code>Tuple</code>[<code>Rank0Tensor</code>, <code>Rank0Tensor</code>]</p>
</blockquote>
<div class="collapse" id="ActivationStats-hook-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#ActivationStats-hook-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>Tests found for <code>hook</code>:</p><p>Some other tests where <code>hook</code> is used:</p><ul><li><code>pytest -sv tests/test_callbacks_hooks.py::test_hook_output_basics</code> <a href="https://github.com/fastai/fastai1/blob/master/tests/test_callbacks_hooks.py#L74" class="source_link" style="float:right">[source]</a></li></ul><p>To run tests please refer to this <a href="/dev/test.html#quick-guide">guide</a>.</p></div></div><p>Take the mean and std of <code>o</code>.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Callback-methods">Callback methods<a class="anchor-link" href="#Callback-methods">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You don't call these yourself - they're called by fastai's <a href="/callback.html#Callback"><code>Callback</code></a> system automatically to enable the class's functionality.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ActivationStats.on_train_begin" class="doc_header"><code>on_train_begin</code><a href="https://github.com/fastai/fastai1/blob/master/fastai/callbacks/hooks.py#L85" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#ActivationStats-on_train_begin-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>on_train_begin</code>(<strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<div class="collapse" id="ActivationStats-on_train_begin-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#ActivationStats-on_train_begin-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>on_train_begin</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Initialize stats.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ActivationStats.on_batch_end" class="doc_header"><code>on_batch_end</code><a href="https://github.com/fastai/fastai1/blob/master/fastai/callbacks/hooks.py#L93" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#ActivationStats-on_batch_end-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>on_batch_end</code>(<strong><code>train</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<div class="collapse" id="ActivationStats-on_batch_end-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#ActivationStats-on_batch_end-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>on_batch_end</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Take the stored results and puts it in <code>self.stats</code></p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ActivationStats.on_train_end" class="doc_header"><code>on_train_end</code><a href="https://github.com/fastai/fastai1/blob/master/fastai/callbacks/hooks.py#L96" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#ActivationStats-on_train_end-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>on_train_end</code>(<strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<div class="collapse" id="ActivationStats-on_train_end-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#ActivationStats-on_train_end-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>on_train_end</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Polish the final result.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Hook" class="doc_header"><code>class</code> <code>Hook</code><a href="https://github.com/fastai/fastai1/blob/master/fastai/callbacks/hooks.py#L10" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#Hook-pytest" style="float:right; padding-right:10px">[test]</a></h2><blockquote><p><code>Hook</code>(<strong><code>m</code></strong>:<a href="https://pytorch.org/docs/stable/nn.html#torch.nn.Module"><code>Module</code></a>, <strong><code>hook_func</code></strong>:<code>HookFunc</code>, <strong><code>is_forward</code></strong>:<code>bool</code>=<strong><em><code>True</code></em></strong>, <strong><code>detach</code></strong>:<code>bool</code>=<strong><em><code>True</code></em></strong>)</p>
</blockquote>
<div class="collapse" id="Hook-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#Hook-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>Hook</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Create a hook on <code>m</code> with <code>hook_func</code>.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Registers and manually deregisters a <a href="https://pytorch.org/tutorials/beginner/former_torchies/nn_tutorial.html#forward-and-backward-function-hooks">PyTorch hook</a>. Your <code>hook_func</code> will be called automatically when forward/backward (depending on <code>is_forward</code>) for your module <code>m</code> is run, and the result of that function is placed in <code>self.stored</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Hook.remove" class="doc_header"><code>remove</code><a href="https://github.com/fastai/fastai1/blob/master/fastai/callbacks/hooks.py#L25" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#Hook-remove-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>remove</code>()</p>
</blockquote>
<div class="collapse" id="Hook-remove-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#Hook-remove-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>remove</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Remove the hook from the model.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Deregister the hook, if not called already.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Hooks" class="doc_header"><code>class</code> <code>Hooks</code><a href="https://github.com/fastai/fastai1/blob/master/fastai/callbacks/hooks.py#L34" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#Hooks-pytest" style="float:right; padding-right:10px">[test]</a></h2><blockquote><p><code>Hooks</code>(<strong><code>ms</code></strong>:<code>ModuleList</code>, <strong><code>hook_func</code></strong>:<code>HookFunc</code>, <strong><code>is_forward</code></strong>:<code>bool</code>=<strong><em><code>True</code></em></strong>, <strong><code>detach</code></strong>:<code>bool</code>=<strong><em><code>True</code></em></strong>)</p>
</blockquote>
<div class="collapse" id="Hooks-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#Hooks-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>Hooks</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Create several hooks on the modules in <code>ms</code> with <code>hook_func</code>.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Acts as a <code>Collection</code> (i.e. <code>len(hooks)</code> and <code>hooks[i]</code>) and an <code>Iterator</code> (i.e. <code>for hook in hooks</code>) of a group of hooks, one for each module in <code>ms</code>, with the ability to remove all as a group. Use <code>stored</code> to get all hook results. <code>hook_func</code> and <code>is_forward</code> behavior is the same as <a href="/callbacks.hooks.html#Hook"><code>Hook</code></a>. See the source code for <a href="/callbacks.hooks.html#HookCallback"><code>HookCallback</code></a> for a simple example.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Hooks.remove" class="doc_header"><code>remove</code><a href="https://github.com/fastai/fastai1/blob/master/fastai/callbacks/hooks.py#L45" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#Hooks-remove-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>remove</code>()</p>
</blockquote>
<div class="collapse" id="Hooks-remove-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#Hooks-remove-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>remove</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Remove the hooks from the model.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Deregister all hooks created by this class, if not previously called.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Convenience-functions-for-hooks">Convenience functions for hooks<a class="anchor-link" href="#Convenience-functions-for-hooks">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="hook_output" class="doc_header"><code>hook_output</code><a href="https://github.com/fastai/fastai1/blob/master/fastai/callbacks/hooks.py#L54" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#hook_output-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>hook_output</code>(<strong><code>module</code></strong>:<a href="https://pytorch.org/docs/stable/nn.html#torch.nn.Module"><code>Module</code></a>, <strong><code>detach</code></strong>:<code>bool</code>=<strong><em><code>True</code></em></strong>, <strong><code>grad</code></strong>:<code>bool</code>=<strong><em><code>False</code></em></strong>) → <a href="/callbacks.hooks.html#Hook"><code>Hook</code></a></p>
</blockquote>
<div class="collapse" id="hook_output-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#hook_output-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>Tests found for <code>hook_output</code>:</p><ul><li><code>pytest -sv tests/test_callbacks_hooks.py::test_hook_output_basics</code> <a href="https://github.com/fastai/fastai1/blob/master/tests/test_callbacks_hooks.py#L74" class="source_link" style="float:right">[source]</a></li></ul><p>To run tests please refer to this <a href="/dev/test.html#quick-guide">guide</a>.</p></div></div><p>Return a <a href="/callbacks.hooks.html#Hook"><code>Hook</code></a> that stores activations of <code>module</code> in <code>self.stored</code></p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Function that creates a <a href="/callbacks.hooks.html#Hook"><code>Hook</code></a> for <code>module</code> that simply stores the output of the layer.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="hook_outputs" class="doc_header"><code>hook_outputs</code><a href="https://github.com/fastai/fastai1/blob/master/fastai/callbacks/hooks.py#L58" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#hook_outputs-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>hook_outputs</code>(<strong><code>modules</code></strong>:<code>ModuleList</code>, <strong><code>detach</code></strong>:<code>bool</code>=<strong><em><code>True</code></em></strong>, <strong><code>grad</code></strong>:<code>bool</code>=<strong><em><code>False</code></em></strong>) → <a href="/callbacks.hooks.html#Hooks"><code>Hooks</code></a></p>
</blockquote>
<div class="collapse" id="hook_outputs-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#hook_outputs-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>hook_outputs</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Return <a href="/callbacks.hooks.html#Hooks"><code>Hooks</code></a> that store activations of all <code>modules</code> in <code>self.stored</code></p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Function that creates a <a href="/callbacks.hooks.html#Hook"><code>Hook</code></a> for all passed <code>modules</code> that simply stores the output of the layers. For example, the (slightly simplified) source code of <a href="/callbacks.hooks.html#model_sizes"><code>model_sizes</code></a> is:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">model_sizes</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">in_channels</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="o">*</span><span class="n">size</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">stored</span><span class="o">.</span><span class="n">shape</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">hook_outputs</span><span class="p">(</span><span class="n">m</span><span class="p">)]</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="model_sizes" class="doc_header"><code>model_sizes</code><a href="https://github.com/fastai/fastai1/blob/master/fastai/callbacks/hooks.py#L110" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#model_sizes-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>model_sizes</code>(<strong><code>m</code></strong>:<a href="https://pytorch.org/docs/stable/nn.html#torch.nn.Module"><code>Module</code></a>, <strong><code>size</code></strong>:<code>tuple</code>=<strong><em><code>(64, 64)</code></em></strong>) → <code>Tuple</code>[<code>Sizes</code>, <code>Tensor</code>, <a href="/callbacks.hooks.html#Hooks"><code>Hooks</code></a>]</p>
</blockquote>
<div class="collapse" id="model_sizes-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#model_sizes-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>model_sizes</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Pass a dummy input through the model <code>m</code> to get the various sizes of activations.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="model_summary" class="doc_header"><code>model_summary</code><a href="https://github.com/fastai/fastai1/blob/master/fastai/callbacks/hooks.py#L165" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#model_summary-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>model_summary</code>(<strong><code>m</code></strong>:<a href="/basic_train.html#Learner"><code>Learner</code></a>, <strong><code>n</code></strong>:<code>int</code>=<strong><em><code>70</code></em></strong>)</p>
</blockquote>
<div class="collapse" id="model_summary-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#model_summary-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>Tests found for <code>model_summary</code>:</p><ul><li><code>pytest -sv tests/test_basic_train.py::test_export_load_learner</code> <a href="https://github.com/fastai/fastai1/blob/master/tests/test_basic_train.py#L214" class="source_link" style="float:right">[source]</a></li><li><code>pytest -sv tests/test_callbacks_hooks.py::test_model_summary_collab</code> <a href="https://github.com/fastai/fastai1/blob/master/tests/test_callbacks_hooks.py#L48" class="source_link" style="float:right">[source]</a></li><li><code>pytest -sv tests/test_callbacks_hooks.py::test_model_summary_tabular</code> <a href="https://github.com/fastai/fastai1/blob/master/tests/test_callbacks_hooks.py#L33" class="source_link" style="float:right">[source]</a></li><li><code>pytest -sv tests/test_callbacks_hooks.py::test_model_summary_text</code> <a href="https://github.com/fastai/fastai1/blob/master/tests/test_callbacks_hooks.py#L26" class="source_link" style="float:right">[source]</a></li><li><code>pytest -sv tests/test_callbacks_hooks.py::test_model_summary_vision</code> <a href="https://github.com/fastai/fastai1/blob/master/tests/test_callbacks_hooks.py#L18" class="source_link" style="float:right">[source]</a></li></ul><p>To run tests please refer to this <a href="/dev/test.html#quick-guide">guide</a>.</p></div></div><p>Print a summary of <code>m</code> using a output text width of <code>n</code> chars</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This method only works on a <a href="/basic_train.html#Learner"><code>Learner</code></a> object with <code>train_ds</code> in it. If it was created as a result of <a href="/basic_train.html#load_learner"><code>load_learner</code></a>, there is no <a href="/vision.data.html#vision.data"><code>data</code></a> to run through the model and therefore it's not possible to create such summary.</p>
<p>A sample <code>summary</code> looks like:</p>

<pre><code>======================================================================
Layer (type)         Output Shape         Param #    Trainable 
======================================================================
Conv2d               [64, 176, 176]       9,408      False     
______________________________________________________________________
BatchNorm2d          [64, 176, 176]       128        True      
______________________________________________________________________
ReLU                 [64, 176, 176]       0          False     
______________________________________________________________________
MaxPool2d            [64, 88, 88]         0          False     
______________________________________________________________________
Conv2d               [64, 88, 88]         36,864     False     
...</code></pre>
<p>Column definition:</p>
<ol>
<li><p><strong>Layer (type)</strong> is the name of the corresponding <a href="https://pytorch.org/docs/stable/nn.html#torch.nn.Module"><code>nn.Module</code></a>.</p>
</li>
<li><p><strong>Output Shape</strong> is the shape of the output of the corresponding layer (minus the batch dimension, which is always the same and has no impact on the model params).</p>
</li>
<li><p><strong>Param #</strong> is the number of weights (and optionally bias), and it will vary for each layer.</p>
<p>The number of params is calculated differently for each layer type. Here is how it's calculated for some of the most common layer types:</p>
<ul>
<li>Conv: <code>kernel_size*kernel_size*ch_in*ch_out</code></li>
<li>Linear: <code>(n_in+bias) * n_out</code></li>
<li>Batchnorm: <code>2 * n_out</code></li>
<li>Embeddings: <code>n_embed * emb_sz</code></li>
</ul>
</li>
<li><p><strong>Trainable</strong> indicates whether a layer is trainable or not.</p>
<ul>
<li>Layers with <code>0</code> parameters are always Untrainable (e.g., <code>ReLU</code> and <code>MaxPool2d</code>).</li>
<li>Other layers are either Trainable or not, usually depending on whether they are frozen or not. See <a href="https://docs.fast.ai/basic_train.html#Discriminative-layer-training">Discriminative layer training</a>.</li>
</ul>
</li>
</ol>
<p>To better understand this summary it helps to also execute <code>learn.model</code> and correlate the two outputs.</p>
<p>Example:</p>
<p>Let's feed to a <a href="/basic_train.html#Learner"><code>Learner</code></a> a dataset of 3-channel images size 352x352 and look at the model and its summary:</p>

<pre><code>data.train_ds[0][0].data.shape
learn = cnn_learner(data, models.resnet34, ...)
print(learn.model)
print(learn.summary())</code></pre>
<p>Here are the outputs with everything but the relevant to the example lines removed:</p>

<pre><code>torch.Size([3, 352, 352])

    [...]
    (0): Conv2d(3, 64, kernel_size=(7, 7), stride=(2, 2), padding=(3, 3), bias=False)
    (1): BatchNorm2d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    [...]
    (3): MaxPool2d(kernel_size=3, stride=2, padding=1, dilation=1, ceil_mode=False)
    [...]
    (conv1): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
    (8): Linear(in_features=512, out_features=37, bias=True)


======================================================================
Layer (type)         Output Shape         Param #    Trainable 
======================================================================
Conv2d               [64, 176, 176]       9,408      False     
______________________________________________________________________
BatchNorm2d          [64, 176, 176]       128        True      
______________________________________________________________________
[...]
MaxPool2d            [64, 88, 88]         0          False    
______________________________________________________________________
Conv2d               [64, 88, 88]         36,864     False     
[...]
______________________________________________________________________
Linear               [37]                 18,981     True</code></pre>
<p><strong>So let's calculate some params:</strong></p>
<p>For the <code>Conv2d</code> layers, multiply the first 4 numbers from the corresponding layer definition:</p>

<pre><code>Conv2d(3, 64, kernel_size=(7, 7), ...)

3*64*7*7 = 9,408

Conv2d(64, 64, kernel_size=(3, 3), ...)

64*64*3*3 = 36,864</code></pre>
<p>For the <code>BatchNorm2d</code> layer, multiply the first number by 2:</p>

<pre><code>BatchNorm2d(64, ...)
64*2 = 128</code></pre>
<p>For <code>Linear</code> we multiply the first 2 and include the bias if it's <code>True</code>:</p>

<pre><code>Linear(in_features=512, out_features=37, bias=True)

(512+1)*37 = 18,981</code></pre>
<p><strong>Now let's calculate some output shapes:</strong></p>
<p>We started with 3x352x352 image and run it through this layer:</p>
<p><code>Conv2d(3, 64, kernel_size=(7, 7), stride=(2, 2), padding=(3, 3), bias=False)</code></p>
<p>How did we get: <code>[64, 176, 176]</code></p>
<p>The number of output channels is <code>64</code>, that's the first dimension in the number above. And then our image of <code>352x352</code> got convolved into <code>176x176</code> because of stride <code>2x2</code> (<code>352/2</code>).</p>
<p>Then we had:</p>
<p><code>MaxPool2d(kernel_size=3, stride=2, padding=1, dilation=1, ceil_mode=False)</code></p>
<p>which reduced <code>[64, 176, 176]</code> to <code>[64, 88, 88]</code> again because of stride 2.</p>
<p>And so on, finishing with:</p>
<p><code>Linear(in_features=512, out_features=37, bias=True)</code></p>
<p>which reduced everything to just <code>[37]</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<div markdown="span" class="alert alert-danger" role="alert"><i class="fa fa-danger-circle"></i> <b>Warning: </b>Known issue: `model_summary` and `Learner.summary` don't work with the AWD LSTM in text models.</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="num_features_model" class="doc_header"><code>num_features_model</code><a href="https://github.com/fastai/fastai1/blob/master/fastai/callbacks/hooks.py#L116" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#num_features_model-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>num_features_model</code>(<strong><code>m</code></strong>:<a href="https://pytorch.org/docs/stable/nn.html#torch.nn.Module"><code>Module</code></a>) → <code>int</code></p>
</blockquote>
<div class="collapse" id="num_features_model-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#num_features_model-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>num_features_model</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Return the number of output features for <code>model</code>.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It can be useful to get the size of each layer of a model (e.g. for printing a summary, or for generating cross-connections for a <a href="/vision.models.unet.html#DynamicUnet"><code>DynamicUnet</code></a>), however they depend on the size of the input. This function calculates the layer sizes by passing in a minimal tensor of <code>size</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="dummy_batch" class="doc_header"><code>dummy_batch</code><a href="https://github.com/fastai/fastai1/blob/master/fastai/callbacks/hooks.py#L101" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#dummy_batch-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>dummy_batch</code>(<strong><code>m</code></strong>:<a href="https://pytorch.org/docs/stable/nn.html#torch.nn.Module"><code>Module</code></a>, <strong><code>size</code></strong>:<code>tuple</code>=<strong><em><code>(64, 64)</code></em></strong>) → <code>Tensor</code></p>
</blockquote>
<div class="collapse" id="dummy_batch-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#dummy_batch-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>dummy_batch</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Create a dummy batch to go through <code>m</code> with <code>size</code>.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="dummy_eval" class="doc_header"><code>dummy_eval</code><a href="https://github.com/fastai/fastai1/blob/master/fastai/callbacks/hooks.py#L106" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#dummy_eval-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>dummy_eval</code>(<strong><code>m</code></strong>:<a href="https://pytorch.org/docs/stable/nn.html#torch.nn.Module"><code>Module</code></a>, <strong><code>size</code></strong>:<code>tuple</code>=<strong><em><code>(64, 64)</code></em></strong>)</p>
</blockquote>
<div class="collapse" id="dummy_eval-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#dummy_eval-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>dummy_eval</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Pass a <a href="/callbacks.hooks.html#dummy_batch"><code>dummy_batch</code></a> in evaluation mode in <code>m</code> with <code>size</code>.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="HookCallback" class="doc_header"><code>class</code> <code>HookCallback</code><a href="https://github.com/fastai/fastai1/blob/master/fastai/callbacks/hooks.py#L62" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#HookCallback-pytest" style="float:right; padding-right:10px">[test]</a></h2><blockquote><p><code>HookCallback</code>(<strong><code>learn</code></strong>:<a href="/basic_train.html#Learner"><code>Learner</code></a>, <strong><code>modules</code></strong>:<code>Sequence</code>[<a href="https://pytorch.org/docs/stable/nn.html#torch.nn.Module"><code>Module</code></a>]=<strong><em><code>None</code></em></strong>, <strong><code>do_remove</code></strong>:<code>bool</code>=<strong><em><code>True</code></em></strong>) :: <a href="/basic_train.html#LearnerCallback"><code>LearnerCallback</code></a></p>
</blockquote>
<div class="collapse" id="HookCallback-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#HookCallback-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>HookCallback</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Callback that can be used to register hooks on <code>modules</code>. Implement the corresponding function in <code>self.hook</code>.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For all <code>modules</code>, uses a callback to automatically register a method <code>self.hook</code> (that you must define in an inherited class) as a hook. This method must have the signature:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span><span class="n">Model</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span><span class="n">Tensors</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span><span class="n">Tensors</span><span class="p">)</span>
</pre></div>
<p>If <code>do_remove</code> then the hook is automatically deregistered at the end of training. See <a href="/callbacks.hooks.html#ActivationStats"><code>ActivationStats</code></a> for a simple example of inheriting from this class.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Callback-methods">Callback methods<a class="anchor-link" href="#Callback-methods">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You don't call these yourself - they're called by fastai's <a href="/callback.html#Callback"><code>Callback</code></a> system automatically to enable the class's functionality.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="HookCallback.on_train_begin" class="doc_header"><code>on_train_begin</code><a href="https://github.com/fastai/fastai1/blob/master/fastai/callbacks/hooks.py#L68" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#HookCallback-on_train_begin-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>on_train_begin</code>(<strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<div class="collapse" id="HookCallback-on_train_begin-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#HookCallback-on_train_begin-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>on_train_begin</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Register the <a href="/callbacks.hooks.html#Hooks"><code>Hooks</code></a> on <code>self.modules</code>.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="HookCallback.on_train_end" class="doc_header"><code>on_train_end</code><a href="https://github.com/fastai/fastai1/blob/master/fastai/callbacks/hooks.py#L74" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#HookCallback-on_train_end-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>on_train_end</code>(<strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<div class="collapse" id="HookCallback-on_train_end-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#HookCallback-on_train_end-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>on_train_end</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Remove the <a href="/callbacks.hooks.html#Hooks"><code>Hooks</code></a>.</p>

</div>

</div>

</div>
</div>

</div>
</div>
 

